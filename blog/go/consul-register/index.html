<!DOCTYPE html>

<html lang="zh-cn"><head>
  <meta charset="utf-8">
  <title>consul服务注册 | Louis Blog</title>

  <!-- mobile responsive meta -->
  <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1">
  <meta name="description" content="有技术 有温度 有情怀">
  
  <meta name="author" content="Louis ">
  <meta name="generator" content="Hugo 0.73.0" />

  <!-- plugins -->
  
  <link rel="stylesheet" href="/plugins/bootstrap/bootstrap.min.css">
  
  <link rel="stylesheet" href="/plugins/slick/slick.css">
  
  <link rel="stylesheet" href="/plugins/fontawesome/font-awesome.min.css">
  
  <link rel="stylesheet" href="/plugins/animate/animate.css">
  
  <link rel="stylesheet" href="/plugins/venobox/venobox.css">
  

  <!-- Main Stylesheet -->
  
  <link rel="stylesheet" href="/scss/style.min.css" media="screen">

  <!--Favicon-->
  <link rel="shortcut icon" href="/images/images/favicon.png " type="image/x-icon">
  <link rel="icon" href="/images/images/favicon.png " type="image/x-icon">

  <!--Algolia-->
  <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/docsearch.js@2.6.3/dist/cdn/docsearch.min.css">
</head>
<body>
<!-- header -->
<header>
  

  <!-- navigation -->
  <div class="navigation bg-white position-relative">
    <div class="container">
      <nav class="navbar navbar-expand-lg navbar-light bg-white">
        <a class="navbar-brand" href="/"><img class="img-fluid pb-lg-3" src="/images/images/logo.png" width="189px" alt="Louis Blog"></a>
        <button class="navbar-toggler border-0" type="button" data-toggle="collapse" data-target="#navigation"
          aria-controls="navigation" aria-expanded="false" aria-label="Toggle navigation">
          <span class="navbar-toggler-icon"></span>
        </button>

        <div class="collapse navbar-collapse text-center" id="navigation">
          <ul class="navbar-nav ml-auto">
            <li class="nav-item">
              <a class="nav-link" href="/"></a>
            </li>
            
            
            <li class="nav-item dropdown">
              <a class="nav-link dropdown-toggle" href="#" role="button" data-toggle="dropdown" aria-haspopup="true"
                aria-expanded="false">
                博客
              </a>
              <div class="dropdown-menu" >
                
                <a class="dropdown-item" href="/categories/kubernetes">Kubernetes</a>
                
                <a class="dropdown-item" href="/categories/sealos">sealos</a>
                
                <a class="dropdown-item" href="/categories/ops">运维相关</a>
                
                <a class="dropdown-item" href="/categories/golang">golang</a>
                
                <a class="dropdown-item" href="/categories/algorithm">algorithm</a>
                
                <a class="dropdown-item" href="/categories/tools">tools</a>
                
                <a class="dropdown-item" href="/blog">全部</a>
                
              </div>
            </li>
            
            
            
            <li class="nav-item">
              <a class="nav-link" href="/team">友情链接</a>
            </li>
            
            
            
            <li class="nav-item dropdown">
              <a class="nav-link dropdown-toggle" href="#" role="button" data-toggle="dropdown" aria-haspopup="true"
                aria-expanded="false">
                关于我
              </a>
              <div class="dropdown-menu" >
                
                <a class="dropdown-item" href="/contact">about</a>
                
                <a class="dropdown-item" href="https://github.com/oldthreefeng">github</a>
                
              </div>
            </li>
            
            
          </ul>

          
          

          
          <!-- search -->
          <div class="search px-4">
            <button id="searchOpen" class="search-btn"><i class="fa fa-search text-dark"></i></button>
            <div class="search-wrapper">
              <form action="/search">
                <input class="search-box form-control" id="js-algolia-btn" name="s" type="search" placeholder="输入搜索词">
              </form>
              <button id="searchClose" class="search-close"><i class="fa fa-close text-dark"></i></button>
            </div>
          </div>
          
          
          <!-- get start btn -->
          <a href="/contact" class="btn btn-primary hover-ripple">联系我</a>
          
        </div>
      </nav>
    </div>
  </div>
  <!-- /navigation -->
</header>
<!-- /header -->


<!-- page title -->
<section class="section bg-cover overlay" style="background-image: url('/'),url('/'),url('/images/images/backgrounds/page-title.jpg');">
  <div class="container">
    <div class="row">
      <div class="col-12">
        <h2 class="text-white mb-3">consul服务注册</h2>
        <!-- breadcrumb -->
        
        <p class="text-white"></p>
      </div>
    </div>
  </div>
</section>
<!-- /page title -->


<!-- blog details -->
<section class="section">
  <div class="container blog">
    <div class="row">
      <div class="col-lg-8">
        <!-- post thumb -->
        <div class="position-relative mb-5">
          <img src="/"  onerror="this.src='https:\/\/pic.fenghong.tech\/proto\/roadway-1149613__340.jpg'" alt="post thumb" class="img-fluid w-100">
           <div class="card-type">Ops</div>
        </div>
        <div class="card-meta text-uppercase mb-2">作者  <strong class="text-dark"><a href="https://www.fenghong.tech">Louis</a></strong>
          
            发表于 <strong class="text-dark">2019年11月13日</strong></div>
        <hr>
        <div class="content">
          <p><code>$ 表示shell , # 表示注释, &gt; 表示mysql</code></p>
<h2 id="consul-部署使用">consul 部署使用</h2>
<p>使用consul，其主要有四大特性：</p>
<p>服务发现：利用服务注册，服务发现功能来实现服务治理。</p>
<p>健康检查：利用consul注册的检查检查函数或脚本来判断服务是否健康，若服务不存在则从注册中心移除该服务，减少故障服务请求。</p>
<p>k/v数据存储：存储kv数据，可以作为服务配置中心来使用。</p>
<p>多数据中心：可以建立多个consul集群通过inter网络进行互联，进一步保证数据可用性。</p>
<p>本人也是刚开始学习consul，感觉使用consul主要也就是两大作用，服务注册发现，配置共享。</p>
<h3 id="使用">使用</h3>
<p>consul启动</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-bash" data-lang="bash">$ nohup consul  agent -server -data-dir<span style="color:#f92672">=</span>/usr/local/consul-data/  -node<span style="color:#f92672">=</span>agent-one -bind<span style="color:#f92672">=</span>0.0.0.0 -bootstrap-expect<span style="color:#f92672">=</span><span style="color:#ae81ff">1</span> -client<span style="color:#f92672">=</span>0.0.0.0 -ui &gt; /usr/local/consul-data/logs/consul.log 2&gt;&amp;<span style="color:#ae81ff">1</span> &amp;

-server 表示是以服务端身份启动
-bind 表示绑定到哪个ip（有些服务器会绑定多块网卡，可以通过bind参数强制指定绑定的ip）
-client 指定客户端访问的ip<span style="color:#f92672">(</span>consul有丰富的api接口，这里的客户端指浏览器或调用方<span style="color:#f92672">)</span>，0.0.0.0表示不限客户端ip
-bootstrap-expect<span style="color:#f92672">=</span><span style="color:#ae81ff">3</span> 表示server集群最低节点数为3，低于这个值将工作不正常<span style="color:#f92672">(</span>注：类似zookeeper一样，通常集群数为奇数，方便选举，consul采用的是raft算法<span style="color:#f92672">)</span>
-data-dir 表示指定数据的存放目录（该目录必须存在）
-node 表示节点在web ui中显示的名称
</code></pre></div><p>查看当前的members</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-bash" data-lang="bash">$ consul members
Node       Address              Status  Type    Build  Protocol  DC   Segment
agent-one  172.16.111.130:8301  alive   server  1.5.2  <span style="color:#ae81ff">2</span>         dc1  &lt;all&gt;
</code></pre></div><p>查看当前的leader</p>
<pre><code>$ curl http://127.0.0.1:8500/v1/status/leader
&quot;172.16.111.130:8300&quot;
$ curl localhost:8500/v1/agent/services | python -m json.tool
{
    &quot;hudongapps&quot;: {
        &quot;Address&quot;: &quot;&quot;,
        &quot;EnableTagOverride&quot;: false,
        &quot;ID&quot;: &quot;hudongapps&quot;,
        &quot;Meta&quot;: {},
        &quot;Port&quot;: 22961,
        &quot;Service&quot;: &quot;hudongapps&quot;,
        &quot;Tags&quot;: [
            &quot;node&quot;
        ],
        &quot;Weights&quot;: {
            &quot;Passing&quot;: 1,
            &quot;Warning&quot;: 1
        }
    },
}
</code></pre><p>发现<code>service-msite</code>服务</p>
<pre><code>$ curl http://127.0.0.1:8500/v1/catalog/service/service-msite | python -m json.tool
[
    {
        &quot;Address&quot;: &quot;172.16.111.130&quot;,
        &quot;CreateIndex&quot;: 424242,
        &quot;Datacenter&quot;: &quot;dc1&quot;,
        &quot;ID&quot;: &quot;7f9c6b5d-8a32-c6f8-e091-0280f2efeddb&quot;,
        &quot;ModifyIndex&quot;: 424242,
        &quot;Node&quot;: &quot;agent-one&quot;,
        &quot;NodeMeta&quot;: {
            &quot;consul-network-segment&quot;: &quot;&quot;
        },
        &quot;ServiceAddress&quot;: &quot;&quot;,
        &quot;ServiceConnect&quot;: {},
        &quot;ServiceEnableTagOverride&quot;: true,
        &quot;ServiceID&quot;: &quot;service-msite-22902&quot;,
        &quot;ServiceKind&quot;: &quot;&quot;,
        &quot;ServiceMeta&quot;: {},
        &quot;ServiceName&quot;: &quot;service-msite&quot;,
        &quot;ServicePort&quot;: 22902,
        &quot;ServiceProxy&quot;: {},
        &quot;ServiceProxyDestination&quot;: &quot;&quot;,
        &quot;ServiceTags&quot;: [
            &quot;go&quot;
        ],
        &quot;ServiceWeights&quot;: {
            &quot;Passing&quot;: 1,
            &quot;Warning&quot;: 1
        },
        &quot;TaggedAddresses&quot;: {
            &quot;lan&quot;: &quot;172.16.111.130&quot;,
            &quot;wan&quot;: &quot;172.16.111.130&quot;
        }
    }
]

</code></pre><h2 id="golang-代码">golang 代码</h2>
<p>注册逻辑</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-go" data-lang="go"><span style="color:#f92672">package</span> <span style="color:#a6e22e">server</span>

<span style="color:#f92672">import</span> (
	<span style="color:#e6db74">&#34;log&#34;</span>

	<span style="color:#e6db74">&#34;service-apis/config&#34;</span>
	<span style="color:#a6e22e">pb</span> <span style="color:#e6db74">&#34;service-apis/proto-apis&#34;</span>

	. <span style="color:#e6db74">&#34;github.com/youpenglai/mfwgo/registry&#34;</span>
	. <span style="color:#e6db74">&#34;github.com/youpenglai/mfwgo/server&#34;</span>
	<span style="color:#e6db74">&#34;google.golang.org/grpc&#34;</span>
)

<span style="color:#66d9ef">func</span> <span style="color:#a6e22e">Setup</span>() {
    <span style="color:#75715e">// 获取配置, 存放name,port等相关信息
</span><span style="color:#75715e"></span>	<span style="color:#a6e22e">cfg</span> <span style="color:#f92672">:=</span> <span style="color:#a6e22e">config</span>.<span style="color:#a6e22e">GetConfig</span>()

	<span style="color:#75715e">// register service
</span><span style="color:#75715e"></span>	<span style="color:#a6e22e">err</span> <span style="color:#f92672">:=</span> <span style="color:#a6e22e">RegisterService</span>(<span style="color:#a6e22e">ServiceRegistration</span>{<span style="color:#a6e22e">ServiceName</span>: <span style="color:#a6e22e">cfg</span>.<span style="color:#a6e22e">ServiceName</span>, <span style="color:#a6e22e">Port</span>: <span style="color:#a6e22e">cfg</span>.<span style="color:#a6e22e">GRPCPort</span>},
		<span style="color:#a6e22e">ServiceRegisterType</span>{<span style="color:#a6e22e">CheckHealth</span>: <span style="color:#a6e22e">CheckHealth</span>{<span style="color:#a6e22e">Type</span>: <span style="color:#e6db74">&#34;grpc&#34;</span>}})
	<span style="color:#66d9ef">if</span> <span style="color:#a6e22e">err</span> <span style="color:#f92672">!=</span> <span style="color:#66d9ef">nil</span> {
		<span style="color:#a6e22e">log</span>.<span style="color:#a6e22e">Fatalf</span>(<span style="color:#e6db74">&#34;register service error: %v&#34;</span>, <span style="color:#a6e22e">err</span>)
		<span style="color:#66d9ef">return</span>
	}

	<span style="color:#75715e">// start server
</span><span style="color:#75715e"></span>	<span style="color:#a6e22e">grpcServer</span> <span style="color:#f92672">:=</span> <span style="color:#a6e22e">NewGRPCServer</span>(<span style="color:#a6e22e">GRPCServerOption</span>{<span style="color:#a6e22e">Port</span>: <span style="color:#a6e22e">cfg</span>.<span style="color:#a6e22e">GRPCPort</span>})
	<span style="color:#a6e22e">addServer</span>(<span style="color:#a6e22e">grpcServer</span>.<span style="color:#a6e22e">GetServer</span>())
	<span style="color:#a6e22e">log</span>.<span style="color:#a6e22e">Fatalln</span>(<span style="color:#a6e22e">grpcServer</span>.<span style="color:#a6e22e">ListenAndServe</span>())
}

<span style="color:#66d9ef">func</span> <span style="color:#a6e22e">addServer</span>(<span style="color:#a6e22e">gServer</span> <span style="color:#f92672">*</span><span style="color:#a6e22e">grpc</span>.<span style="color:#a6e22e">Server</span>) {
	<span style="color:#a6e22e">pb</span>.<span style="color:#a6e22e">RegisterApisServer</span>(<span style="color:#a6e22e">gServer</span>, <span style="color:#f92672">&amp;</span><span style="color:#a6e22e">ApisServer</span>{})
}
</code></pre></div><p>启动服务</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-go" data-lang="go"><span style="color:#f92672">package</span> <span style="color:#a6e22e">main</span>

<span style="color:#f92672">import</span> (
	<span style="color:#e6db74">&#34;service-apis/config&#34;</span>
	<span style="color:#e6db74">&#34;service-apis/routers&#34;</span>
	<span style="color:#e6db74">&#34;service-apis/server&#34;</span>
)

<span style="color:#66d9ef">func</span> <span style="color:#a6e22e">main</span>() {
	<span style="color:#a6e22e">config</span>.<span style="color:#a6e22e">Setup</span>()
	<span style="color:#66d9ef">go</span> <span style="color:#a6e22e">server</span>.<span style="color:#a6e22e">Setup</span>()  <span style="color:#75715e">//注册服务
</span><span style="color:#75715e"></span>	<span style="color:#a6e22e">routers</span>.<span style="color:#a6e22e">Setup</span>()	   <span style="color:#75715e">//起服务
</span><span style="color:#75715e"></span>}
</code></pre></div><p>其中注册和discover发现逻辑.</p>
<pre><code>package registry

import (
	&quot;encoding/json&quot;
	&quot;errors&quot;
	&quot;fmt&quot;
	&quot;os&quot;
	&quot;strconv&quot;
)

var (
	consulIp   = &quot;127.0.0.1&quot;
	consulPort = 8500
)

// 支持从环境变量中获取
func initConsul() {
	ip := os.Getenv(&quot;MFW_CONSUL_IP&quot;)
	if ip != &quot;&quot; {
		consulIp = ip
	}
	port := os.Getenv(&quot;MFW_CONSUL_PORT&quot;)
	if port != &quot;&quot; {
		v, e := strconv.ParseInt(port, 10, 32)
		if e != nil {
			return
		}
		consulPort = int(v)
	}
}

const (
	deregisterInterval = &quot;10m&quot;
	tagGo              = &quot;go&quot;
	checkInterval      = &quot;30s&quot;
)

type ServiceRegisterInfo struct {
	ID                string      `json:&quot;ID&quot;`
	Name              string      `json:&quot;Name&quot;`
	Port              int64       `json:&quot;Port&quot;`
	Tags              []string    `json:&quot;Tags&quot;`
	Check             interface{} `json:&quot;Check&quot;`
	EnableTagOverride bool        `json:&quot;EnableTagOverride&quot;`
}

type HTTPCheck struct {
	DeregisterCriticalServiceAfter string `json:&quot;DeregisterCriticalServiceAfter&quot;`
	HTTP                           string `json:&quot;HTTP&quot;`
	Interval                       string `json:&quot;Interval&quot;`
}

type GRPCCheck struct {
	DeregisterCriticalServiceAfter string `json:&quot;DeregisterCriticalServiceAfter&quot;`
	GRPC                           string `json:&quot;GRPC&quot;`
	Interval                       string `json:&quot;Interval&quot;`
}

type ServiceHealthInfo struct {
	Node    Node              `json:&quot;Node&quot;`
	Service ConsulServiceInfo `json:&quot;Service&quot;`
	Checks  []Check           `json:&quot;Checks&quot;`
}

type Node struct {
	Address string `json:&quot;Address&quot;`
}

type Check struct {
	ServiceID   string `json:&quot;ServiceID&quot;`
	ServiceName string `json:&quot;ServiceName&quot;`
	Status      string `json:&quot;Status&quot;`
}

type ConsulServiceInfo struct {
	ID   string   `json:&quot;ID&quot;`
	Name string   `json:&quot;Service&quot;`
	Port int64    `json:&quot;Port&quot;`
	Tags []string `json:&quot;Tags&quot;`
}

type ConsulService struct{}

func NewConsulService() *ConsulService {
	return &amp;ConsulService{}
}

func (c *ConsulService) Register(name string, port int64, healthType string) error {
	url := fmt.Sprintf(&quot;http://%s:%d/v1/agent/service/register&quot;, consulIp, consulPort)
	headers := map[string]string{
		&quot;Content-Type&quot;: &quot;application/json&quot;,
	}

	var check interface{}
	switch healthType {
	case &quot;http&quot;:
		check = HTTPCheck{
			DeregisterCriticalServiceAfter: deregisterInterval,
			HTTP:                           fmt.Sprintf(&quot;http://%s:%d/health&quot;, consulIp, port),
			Interval:                       checkInterval,
		}
	case &quot;grpc&quot;:
		check = GRPCCheck{
			DeregisterCriticalServiceAfter: deregisterInterval,
			GRPC:                           fmt.Sprintf(&quot;%s:%d&quot;, consulIp, port),
			Interval:                       checkInterval,
		}
	}

	register := ServiceRegisterInfo{
		Name:              name,
		Port:              port,
		ID:                fmt.Sprintf(&quot;%v-%v&quot;, name, port),
		Tags:              []string{tagGo},
		Check:             check,
		EnableTagOverride: true,
	}
	data, _ := json.Marshal(register)

	errMsg, err := HttpPutWithHeader(url, headers, data)
	if err != nil {
		return err
	}

	if string(errMsg) != &quot;&quot; {
		return errors.New(string(errMsg))
	}

	return c.GetServicesToCache(name)
}

func (c *ConsulService) GetServices(serviceName string) ([]*ServiceInfo, error) {
	url := fmt.Sprintf(&quot;http://%s:%d/v1/health/service/%s?passing&quot;, consulIp, consulPort, serviceName)
	headers := map[string]string{}

	result, err := HttpGetWithHeader(url, headers)
	if err != nil {
		return nil, err
	}

	var infos []ServiceHealthInfo
	if err := json.Unmarshal(result, &amp;infos); err != nil {
		return nil, err
	}

	//if len(infos) == 0 {
	//	return nil, errors.New(&quot;not found service: &quot; + serviceName)
	//}

	var validInfos []*ServiceInfo
	for _, info := range infos {
		validInfos = append(validInfos, &amp;ServiceInfo{
			Address: info.Node.Address,
			Port:    info.Service.Port,
			Tags:    info.Service.Tags,
		})
	}

	return validInfos, nil
}

func (c *ConsulService) GetServicesToCache(serviceName string) error {
	infos, err := c.GetServices(serviceName)
	if err != nil {
		return err
	}
	// consul
	return gConsulCache.Set(serviceName, infos)
}

func init() {
	initConsul()
}
</code></pre><p>注册consul后, 查询具体使用curl来进行查询.</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-bash" data-lang="bash">$ curl localhost:8500/v1/agent/services | python -m json.tool 
  <span style="color:#e6db74">&#34;service-apis-22906&#34;</span>: <span style="color:#f92672">{</span>
        <span style="color:#e6db74">&#34;Address&#34;</span>: <span style="color:#e6db74">&#34;&#34;</span>,
        <span style="color:#e6db74">&#34;EnableTagOverride&#34;</span>: true,
        <span style="color:#e6db74">&#34;ID&#34;</span>: <span style="color:#e6db74">&#34;service-apis-22906&#34;</span>,
        <span style="color:#e6db74">&#34;Meta&#34;</span>: <span style="color:#f92672">{}</span>,
        <span style="color:#e6db74">&#34;Port&#34;</span>: 22906,
        <span style="color:#e6db74">&#34;Service&#34;</span>: <span style="color:#e6db74">&#34;service-apis&#34;</span>,
        <span style="color:#e6db74">&#34;Tags&#34;</span>: <span style="color:#f92672">[</span>
            <span style="color:#e6db74">&#34;go&#34;</span>
        <span style="color:#f92672">]</span>,
        <span style="color:#e6db74">&#34;Weights&#34;</span>: <span style="color:#f92672">{</span>
            <span style="color:#e6db74">&#34;Passing&#34;</span>: 1,
            <span style="color:#e6db74">&#34;Warning&#34;</span>: <span style="color:#ae81ff">1</span>
        <span style="color:#f92672">}</span>
    <span style="color:#f92672">}</span>,
</code></pre></div><p>使用官方的api操作</p>
<pre><code>package main
 
import (
    &quot;github.com/gin-gonic/gin&quot;
 
    consulapi &quot;github.com/hashicorp/consul/api&quot;
    &quot;net/http&quot;
    &quot;fmt&quot;
    &quot;log&quot;
)
 
func main() {
    r := gin.Default()
 
    // consul健康检查回调函数
    r.GET(&quot;/&quot;, func(c *gin.Context) {
        c.JSON(200, gin.H{
            &quot;message&quot;: &quot;ok&quot;,
        })
    })
 
 
    // 注册服务到consul
    ConsulRegister()
 
    // 从consul中发现服务
    ConsulFindServer()
 
    // 取消consul注册的服务
    //ConsulDeRegister()
 
 
    http.ListenAndServe(&quot;:8081&quot;, r)
}
 
// 注册服务到consul
func ConsulRegister()  {
    // 创建连接consul服务配置
    config := consulapi.DefaultConfig()
    config.Address = &quot;127.0.0.1:8500&quot;
    client, err := consulapi.NewClient(config)
    if err != nil {
        log.Fatal(&quot;consul client error : &quot;, err)
    }
 
    // 创建注册到consul的服务到
    registration := new(consulapi.AgentServiceRegistration)
    registration.ID = &quot;111&quot;
    registration.Name = &quot;go-consul-test&quot;
    registration.Port = 8081
    registration.Tags = []string{&quot;go-consul-test&quot;}
    registration.Address = &quot;10.13.153.128&quot;
 
    // 增加consul健康检查回调函数
    check := new(consulapi.AgentServiceCheck)
    check.HTTP = fmt.Sprintf(&quot;http://%s:%d&quot;, registration.Address, registration.Port)
    check.Timeout = &quot;5s&quot;
    check.Interval = &quot;5s&quot;
    check.DeregisterCriticalServiceAfter = &quot;30s&quot; // 故障检查失败30s后 consul自动将注册服务删除
    registration.Check = check
 
    // 注册服务到consul
    err = client.Agent().ServiceRegister(registration)
}
 
// 取消consul注册的服务
func ConsulDeRegister()  {
    // 创建连接consul服务配置
    config := consulapi.DefaultConfig()
    config.Address = &quot;127.0.0.1:8500&quot;
    client, err := consulapi.NewClient(config)
    if err != nil {
        log.Fatal(&quot;consul client error : &quot;, err)
    }
 
    client.Agent().ServiceDeregister(&quot;111&quot;)
}
 
// 从consul中发现服务
func ConsulFindServer()  {
    // 创建连接consul服务配置
    config := consulapi.DefaultConfig()
    config.Address = &quot;127.0.0.1:8500&quot;
    client, err := consulapi.NewClient(config)
    if err != nil {
        log.Fatal(&quot;consul client error : &quot;, err)
    }
 
    // 获取所有service
    services, _ := client.Agent().Services()
    for _, value := range services{
        fmt.Println(value.Address)
        fmt.Println(value.Port)
    }
 
    fmt.Println(&quot;=================================&quot;)
    // 获取指定service
    service, _, err := client.Agent().Service(&quot;111&quot;, nil)
    if err == nil{
        fmt.Println(service.Address)
        fmt.Println(service.Port)
    }
 
}
 
func ConsulCheckHeath()  {
    // 创建连接consul服务配置
    config := consulapi.DefaultConfig()
    config.Address = &quot;127.0.0.1:8500&quot;
    client, err := consulapi.NewClient(config)
    if err != nil {
        log.Fatal(&quot;consul client error : &quot;, err)
    }
 
    // 健康检查
    a, b, _ := client.Agent().AgentHealthServiceByID(&quot;111&quot;)
    fmt.Println(a)
    fmt.Println(b)
}
 
func ConsulKVTest()  {
    // 创建连接consul服务配置
    config := consulapi.DefaultConfig()
    config.Address = &quot;127.0.0.1:8500&quot;
    client, err := consulapi.NewClient(config)
    if err != nil {
        log.Fatal(&quot;consul client error : &quot;, err)
    }
 
    // KV, put值
    values := &quot;test&quot;
    key := &quot;go-consul-test/127.0.0.1:8100&quot;
    client.KV().Put(&amp;consulapi.KVPair{Key:key, Flags:0, Value: []byte(values)}, nil)
 
    // KV get值
    data, _, _ := client.KV().Get(key, nil)
    fmt.Println(string(data.Value))
 
    // KV list
    datas, _ , _:= client.KV().List(&quot;go&quot;, nil)
    for _ , value := range datas{
        fmt.Println(value)
    }
    keys, _ , _ := client.KV().Keys(&quot;go&quot;, &quot;&quot;, nil)
    fmt.Println(keys)
}
</code></pre><p>根据此功能专门做一个服务管理的模块，客户端注册服务到服务模块，服务管理去提供其他模块的服务发现的功能，同时跟监控结合，当服务不可用时，或服务不存在时，通过监控通知相关人员，我们也可以使用页面跟我们服务管理结合，通过前台服务录入形式进行注册服务.</p>
<p>参考</p>
<ul>
<li><a href="https://github.com/hashicorp/consul">consul官方网站</a></li>
</ul>

        </div>
        <!-- tags -->
        <div class="mb-3">
          <h5 class="d-inline-block mr-3">Tags:</h5>
          <ul class="list-inline d-inline-block">
            <a>
            <li class="list-inline-item"><a class="text-color" href="/tags/consul"> 
            Consul</a>
            <a>
            <li class="list-inline-item"><a class="text-color" href="/tags/cluster"> , 
            Cluster</a>
            <a>
            <li class="list-inline-item"><a class="text-color" href="/tags/go"> , 
            Go</a>
            
          </ul>
        </div>
        <!-- previous -->
        <div class="mb-3 link-article">
    <div class="pre-article">
        
            <div><i class="fa fa-arrow-left"></i> 上一篇</div>
            <a href="https://www.fenghong.tech/blog/living/interview/">2019年面试</a>
        
    </div>
    <div class="next-article">
        
            <div>下一篇 <i class="fa fa-arrow-right"></i></div>
            <a href="https://www.fenghong.tech/blog/docker/golang-with-docker/">golang项目docker化</a>
        
    </div>
</div>
        <!-- previous -->

        <!-- recommend -->
        

<div class="mb-3">
  <h2>文章推荐</h2>
  <ul class="related">
  
    <li><a href="/blog/go/rabbitmq-queue-use/">RabbitMq消息队列使用</a></li>
  
    <li><a href="/blog/ops/rabbitmq-cluster-install/">RabbitMq高可用集群搭建</a></li>
  
    <li><a href="/blog/go/go-syncd-cli/">syncd-cli 介绍及用法</a></li>
  
    <li><a href="/blog/go/go-ssh/">go ssh实现</a></li>
  
    <li><a href="/blog/algorithm/paxos/">go Paxos</a></li>
  
  </ul>
</div>


        <!-- comments -->

        
        <div id="gitalk-container"></div>
        <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/gitalk@1/dist/gitalk.css">
        <script src="https://cdn.jsdelivr.net/npm/gitalk@1/dist/gitalk.min.js"></script>
        <script>
          window.onload = function() {
              const gitalk = new Gitalk({
              clientID: 'a0a546df858aafb5300e',
              clientSecret: '67d7b40de25c072fc38840ffb9c06ceab7ef5080',
              repo: 'oldthreefeng.github.io',
              owner: 'oldthreefeng',
              admin: ['oldthreefeng'],
              id: hex_md5(hex_md5(window.location.pathname + window.location.hash)), 
              distractionFreeMode: false 
            });
            (function() {
              if (["localhost", "127.0.0.1"].indexOf(window.location.hostname) != -1) {
                document.getElementById('gitalk-container').innerHTML = 'Gitalk comments not available by default when the website is previewed locally.';
                return;
              }
              gitalk.render('gitalk-container');
            })();
          }
        </script>
        
      </div>
      <!-- sidebar -->
<aside class="col-lg-4 order-1 order-lg-2">
  <!-- tags -->
  <div class="bg-white px-4 py-5 box-shadow mb-5 word-cloud">
    <h4 class="mb-4">标签</h4>
    
      
      
      
      
      
      
      
      
      
      
      
      <div id="tag-cloud" style="padding: 5px 15px">
      
        
          
          
          
          <a href="/tags/acme" style="font-size:1.0188679245283019rem">acme</a>
        
      
        
          
          
          &middot;
          <a href="/tags/acmetiny" style="font-size:1.0188679245283019rem">acmetiny</a>
        
      
        
          
          
          &middot;
          <a href="/tags/alertmanager" style="font-size:1rem">alertmanager</a>
        
      
        
          
          
          &middot;
          <a href="/tags/algorithm" style="font-size:1.1132075471698113rem">algorithm</a>
        
      
        
          
          
          &middot;
          <a href="/tags/aliyun" style="font-size:1rem">aliyun</a>
        
      
        
          
          
          &middot;
          <a href="/tags/ansible" style="font-size:1.0754716981132075rem">ansible</a>
        
      
        
          
          
          &middot;
          <a href="/tags/apisix" style="font-size:1rem">apisix</a>
        
      
        
          
          
          &middot;
          <a href="/tags/arm64" style="font-size:1.0188679245283019rem">arm64</a>
        
      
        
          
          
          &middot;
          <a href="/tags/authorization" style="font-size:1rem">authorization</a>
        
      
        
          
          
          &middot;
          <a href="/tags/backup" style="font-size:1.0377358490566038rem">backup</a>
        
      
        
          
          
          &middot;
          <a href="/tags/binarysearch" style="font-size:1.0188679245283019rem">binarysearch</a>
        
      
        
          
          
          &middot;
          <a href="/tags/binlog" style="font-size:1rem">binlog</a>
        
      
        
          
          
          &middot;
          <a href="/tags/bit" style="font-size:1.0188679245283019rem">bit</a>
        
      
        
          
          
          &middot;
          <a href="/tags/bug" style="font-size:1.0188679245283019rem">bug</a>
        
      
        
          
          
          &middot;
          <a href="/tags/cache" style="font-size:1rem">cache</a>
        
      
        
          
          
          &middot;
          <a href="/tags/certbot" style="font-size:1rem">certbot</a>
        
      
        
          
          
          &middot;
          <a href="/tags/channel" style="font-size:1rem">channel</a>
        
      
        
          
          
          &middot;
          <a href="/tags/chrome" style="font-size:1.0188679245283019rem">chrome</a>
        
      
        
          
          
          &middot;
          <a href="/tags/ci" style="font-size:1rem">ci</a>
        
      
        
          
          
          &middot;
          <a href="/tags/cluster" style="font-size:1.1132075471698113rem">cluster</a>
        
      
        
          
          
          &middot;
          <a href="/tags/cobra" style="font-size:1rem">cobra</a>
        
      
        
          
          
          &middot;
          <a href="/tags/coco" style="font-size:1.0377358490566038rem">coco</a>
        
      
        
          
          
          &middot;
          <a href="/tags/coding" style="font-size:1rem">coding</a>
        
      
        
          
          
          &middot;
          <a href="/tags/computer" style="font-size:1rem">computer</a>
        
      
        
          
          
          &middot;
          <a href="/tags/consul" style="font-size:1rem">consul</a>
        
      
        
          
          
          &middot;
          <a href="/tags/containerd" style="font-size:1.0188679245283019rem">containerd</a>
        
      
        
          
          
          &middot;
          <a href="/tags/coredns" style="font-size:1rem">coredns</a>
        
      
        
          
          
          &middot;
          <a href="/tags/cors" style="font-size:1rem">cors</a>
        
      
        
          
          
          &middot;
          <a href="/tags/crypto" style="font-size:1rem">crypto</a>
        
      
        
          
          
          &middot;
          <a href="/tags/curl" style="font-size:1rem">curl</a>
        
      
        
          
          
          &middot;
          <a href="/tags/dashboard" style="font-size:1rem">dashboard</a>
        
      
        
          
          
          &middot;
          <a href="/tags/dcdn" style="font-size:1rem">dcdn</a>
        
      
        
          
          
          &middot;
          <a href="/tags/debt" style="font-size:1rem">debt</a>
        
      
        
          
          
          &middot;
          <a href="/tags/devops" style="font-size:1.0188679245283019rem">devops</a>
        
      
        
          
          
          &middot;
          <a href="/tags/dingding" style="font-size:1rem">dingding</a>
        
      
        
          
          
          &middot;
          <a href="/tags/disk" style="font-size:1rem">disk</a>
        
      
        
          
          
          &middot;
          <a href="/tags/dmesg" style="font-size:1rem">dmesg</a>
        
      
        
          
          
          &middot;
          <a href="/tags/dns" style="font-size:1rem">dns</a>
        
      
        
          
          
          &middot;
          <a href="/tags/docker" style="font-size:1.2264150943396226rem">docker</a>
        
      
        
          
          
          &middot;
          <a href="/tags/doublylinkedlist" style="font-size:1rem">doublylinkedlist</a>
        
      
        
          
          
          &middot;
          <a href="/tags/elk" style="font-size:1rem">elk</a>
        
      
        
          
          
          &middot;
          <a href="/tags/error" style="font-size:1rem">error</a>
        
      
        
          
          
          &middot;
          <a href="/tags/etcd" style="font-size:1.0377358490566038rem">etcd</a>
        
      
        
          
          
          &middot;
          <a href="/tags/exec" style="font-size:1.0188679245283019rem">exec</a>
        
      
        
          
          
          &middot;
          <a href="/tags/exp" style="font-size:1rem">exp</a>
        
      
        
          
          
          &middot;
          <a href="/tags/federated" style="font-size:1rem">federated</a>
        
      
        
          
          
          &middot;
          <a href="/tags/filecoin" style="font-size:1rem">filecoin</a>
        
      
        
          
          
          &middot;
          <a href="/tags/find" style="font-size:1rem">find</a>
        
      
        
          
          
          &middot;
          <a href="/tags/firewalld" style="font-size:1rem">firewalld</a>
        
      
        
          
          
          &middot;
          <a href="/tags/fix" style="font-size:1.0377358490566038rem">fix</a>
        
      
        
          
          
          &middot;
          <a href="/tags/flag" style="font-size:1.0188679245283019rem">flag</a>
        
      
        
          
          
          &middot;
          <a href="/tags/flannel" style="font-size:1rem">flannel</a>
        
      
        
          
          
          &middot;
          <a href="/tags/food" style="font-size:1.0188679245283019rem">food</a>
        
      
        
          
          
          &middot;
          <a href="/tags/frp" style="font-size:1.0377358490566038rem">frp</a>
        
      
        
          
          
          &middot;
          <a href="/tags/ftp" style="font-size:1.0188679245283019rem">ftp</a>
        
      
        
          
          
          &middot;
          <a href="/tags/games" style="font-size:1rem">games</a>
        
      
        
          
          
          &middot;
          <a href="/tags/gin" style="font-size:1.0188679245283019rem">gin</a>
        
      
        
          
          
          &middot;
          <a href="/tags/git" style="font-size:1.2075471698113207rem">git</a>
        
      
        
          
          
          &middot;
          <a href="/tags/github" style="font-size:1.0188679245283019rem">github</a>
        
      
        
          
          
          &middot;
          <a href="/tags/gitlab" style="font-size:1rem">gitlab</a>
        
      
        
          
          
          &middot;
          <a href="/tags/go" style="font-size:1.320754716981132rem">go</a>
        
      
        
          
          
          &middot;
          <a href="/tags/go-vim" style="font-size:1rem">go-vim</a>
        
      
        
          
          
          &middot;
          <a href="/tags/gogs" style="font-size:1.0566037735849056rem">gogs</a>
        
      
        
          
          
          &middot;
          <a href="/tags/goland" style="font-size:1.0188679245283019rem">goland</a>
        
      
        
          
          
          &middot;
          <a href="/tags/golang" style="font-size:1.0377358490566038rem">golang</a>
        
      
        
          
          
          &middot;
          <a href="/tags/gorequest" style="font-size:1rem">gorequest</a>
        
      
        
          
          
          &middot;
          <a href="/tags/grafana" style="font-size:1.0188679245283019rem">grafana</a>
        
      
        
          
          
          &middot;
          <a href="/tags/grub" style="font-size:1rem">grub</a>
        
      
        
          
          
          &middot;
          <a href="/tags/hack" style="font-size:1.0188679245283019rem">hack</a>
        
      
        
          
          
          &middot;
          <a href="/tags/haproxy" style="font-size:1.0377358490566038rem">haproxy</a>
        
      
        
          
          
          &middot;
          <a href="/tags/harbor" style="font-size:1.0188679245283019rem">harbor</a>
        
      
        
          
          
          &middot;
          <a href="/tags/hash" style="font-size:1.0188679245283019rem">hash</a>
        
      
        
          
          
          &middot;
          <a href="/tags/hashmap" style="font-size:1rem">hashmap</a>
        
      
        
          
          
          &middot;
          <a href="/tags/helm" style="font-size:1.0188679245283019rem">helm</a>
        
      
        
          
          
          &middot;
          <a href="/tags/hexo" style="font-size:1.0377358490566038rem">hexo</a>
        
      
        
          
          
          &middot;
          <a href="/tags/http" style="font-size:1.0754716981132075rem">http</a>
        
      
        
          
          
          &middot;
          <a href="/tags/https" style="font-size:1rem">https</a>
        
      
        
          
          
          &middot;
          <a href="/tags/index" style="font-size:1rem">index</a>
        
      
        
          
          
          &middot;
          <a href="/tags/ingress" style="font-size:1.0377358490566038rem">ingress</a>
        
      
        
          
          
          &middot;
          <a href="/tags/inotify" style="font-size:1rem">inotify</a>
        
      
        
          
          
          &middot;
          <a href="/tags/internet" style="font-size:1.169811320754717rem">internet</a>
        
      
        
          
          
          &middot;
          <a href="/tags/interview" style="font-size:1rem">interview</a>
        
      
        
          
          
          &middot;
          <a href="/tags/iptables" style="font-size:1.0377358490566038rem">iptables</a>
        
      
        
          
          
          &middot;
          <a href="/tags/ipvs" style="font-size:1.0188679245283019rem">ipvs</a>
        
      
        
          
          
          &middot;
          <a href="/tags/java" style="font-size:1.0754716981132075rem">java</a>
        
      
        
          
          
          &middot;
          <a href="/tags/jeju" style="font-size:1rem">jeju</a>
        
      
        
          
          
          &middot;
          <a href="/tags/jenkins" style="font-size:1.0943396226415094rem">jenkins</a>
        
      
        
          
          
          &middot;
          <a href="/tags/jetbrains" style="font-size:1rem">jetbrains</a>
        
      
        
          
          
          &middot;
          <a href="/tags/jumpserver" style="font-size:1.0566037735849056rem">jumpserver</a>
        
      
        
          
          
          &middot;
          <a href="/tags/jvm" style="font-size:1rem">jvm</a>
        
      
        
          
          
          &middot;
          <a href="/tags/keepalived" style="font-size:1rem">keepalived</a>
        
      
        
          
          
          &middot;
          <a href="/tags/kernel" style="font-size:1rem">kernel</a>
        
      
        
          
          
          &middot;
          <a href="/tags/knowledge" style="font-size:1rem">knowledge</a>
        
      
        
          
          
          &middot;
          <a href="/tags/kube-proxy" style="font-size:1.0188679245283019rem">kube-proxy</a>
        
      
        
          
          
          &middot;
          <a href="/tags/kubernetes" style="font-size:1.3962264150943395rem">kubernetes</a>
        
      
        
          
          
          &middot;
          <a href="/tags/kubernetesrbac" style="font-size:1rem">kubernetesrbac</a>
        
      
        
          
          
          &middot;
          <a href="/tags/kubernetesssl" style="font-size:1.0188679245283019rem">kubernetesssl</a>
        
      
        
          
          
          &middot;
          <a href="/tags/kuboard" style="font-size:1.0566037735849056rem">kuboard</a>
        
      
        
          
          
          &middot;
          <a href="/tags/lb" style="font-size:1rem">lb</a>
        
      
        
          
          
          &middot;
          <a href="/tags/learning" style="font-size:1.0566037735849056rem">learning</a>
        
      
        
          
          
          &middot;
          <a href="/tags/leetcode" style="font-size:1.0188679245283019rem">leetcode</a>
        
      
        
          
          
          &middot;
          <a href="/tags/libcurl" style="font-size:1rem">libcurl</a>
        
      
        
          
          
          &middot;
          <a href="/tags/libssh2" style="font-size:1rem">libssh2</a>
        
      
        
          
          
          &middot;
          <a href="/tags/link" style="font-size:1rem">link</a>
        
      
        
          
          
          &middot;
          <a href="/tags/linux" style="font-size:1.9811320754716981rem">linux</a>
        
      
        
          
          
          &middot;
          <a href="/tags/living" style="font-size:1rem">living</a>
        
      
        
          
          
          &middot;
          <a href="/tags/lnux" style="font-size:1rem">lnux</a>
        
      
        
          
          
          &middot;
          <a href="/tags/log" style="font-size:1.0566037735849056rem">log</a>
        
      
        
          
          
          &middot;
          <a href="/tags/logrus" style="font-size:1rem">logrus</a>
        
      
        
          
          
          &middot;
          <a href="/tags/logs" style="font-size:1rem">logs</a>
        
      
        
          
          
          &middot;
          <a href="/tags/logstash" style="font-size:1rem">logstash</a>
        
      
        
          
          
          &middot;
          <a href="/tags/loki" style="font-size:1rem">loki</a>
        
      
        
          
          
          &middot;
          <a href="/tags/lru" style="font-size:1rem">lru</a>
        
      
        
          
          
          &middot;
          <a href="/tags/luna" style="font-size:1rem">luna</a>
        
      
        
          
          
          &middot;
          <a href="/tags/lvm" style="font-size:1rem">lvm</a>
        
      
        
          
          
          &middot;
          <a href="/tags/lvs" style="font-size:1rem">lvs</a>
        
      
        
          
          
          &middot;
          <a href="/tags/mac" style="font-size:1rem">mac</a>
        
      
        
          
          
          &middot;
          <a href="/tags/malaysia" style="font-size:1rem">malaysia</a>
        
      
        
          
          
          &middot;
          <a href="/tags/manage" style="font-size:1rem">manage</a>
        
      
        
          
          
          &middot;
          <a href="/tags/map" style="font-size:1rem">map</a>
        
      
        
          
          
          &middot;
          <a href="/tags/mariadb" style="font-size:1.0377358490566038rem">mariadb</a>
        
      
        
          
          
          &middot;
          <a href="/tags/markdown" style="font-size:1.0188679245283019rem">markdown</a>
        
      
        
          
          
          &middot;
          <a href="/tags/mfa" style="font-size:1rem">mfa</a>
        
      
        
          
          
          &middot;
          <a href="/tags/mha" style="font-size:1rem">mha</a>
        
      
        
          
          
          &middot;
          <a href="/tags/mode" style="font-size:1rem">mode</a>
        
      
        
          
          
          &middot;
          <a href="/tags/module" style="font-size:1rem">module</a>
        
      
        
          
          
          &middot;
          <a href="/tags/mount" style="font-size:1rem">mount</a>
        
      
        
          
          
          &middot;
          <a href="/tags/mysql" style="font-size:1.2452830188679245rem">mysql</a>
        
      
        
          
          
          &middot;
          <a href="/tags/navicat" style="font-size:1rem">navicat</a>
        
      
        
          
          
          &middot;
          <a href="/tags/network" style="font-size:1rem">network</a>
        
      
        
          
          
          &middot;
          <a href="/tags/nfs" style="font-size:1.0754716981132075rem">nfs</a>
        
      
        
          
          
          &middot;
          <a href="/tags/nginx" style="font-size:1.2264150943396226rem">nginx</a>
        
      
        
          
          
          &middot;
          <a href="/tags/nginxingress" style="font-size:1.0566037735849056rem">nginxingress</a>
        
      
        
          
          
          &middot;
          <a href="/tags/node_exporter" style="font-size:1.0188679245283019rem">node_exporter</a>
        
      
        
          
          
          &middot;
          <a href="/tags/numpy" style="font-size:1rem">numpy</a>
        
      
        
          
          
          &middot;
          <a href="/tags/ops" style="font-size:1.2452830188679245rem">ops</a>
        
      
        
          
          
          &middot;
          <a href="/tags/owncloud" style="font-size:1rem">owncloud</a>
        
      
        
          
          
          &middot;
          <a href="/tags/password" style="font-size:1rem">password</a>
        
      
        
          
          
          &middot;
          <a href="/tags/paxos" style="font-size:1.0188679245283019rem">paxos</a>
        
      
        
          
          
          &middot;
          <a href="/tags/php" style="font-size:1rem">php</a>
        
      
        
          
          
          &middot;
          <a href="/tags/pipeline" style="font-size:1rem">pipeline</a>
        
      
        
          
          
          &middot;
          <a href="/tags/polynomial" style="font-size:1rem">polynomial</a>
        
      
        
          
          
          &middot;
          <a href="/tags/problem" style="font-size:1rem">problem</a>
        
      
        
          
          
          &middot;
          <a href="/tags/prometheus" style="font-size:1.0943396226415094rem">prometheus</a>
        
      
        
          
          
          &middot;
          <a href="/tags/pv" style="font-size:1.0754716981132075rem">pv</a>
        
      
        
          
          
          &middot;
          <a href="/tags/pvc" style="font-size:1.0754716981132075rem">pvc</a>
        
      
        
          
          
          &middot;
          <a href="/tags/python" style="font-size:1.0943396226415094rem">python</a>
        
      
        
          
          
          &middot;
          <a href="/tags/queue" style="font-size:1rem">queue</a>
        
      
        
          
          
          &middot;
          <a href="/tags/qw3xt" style="font-size:1rem">qw3xt</a>
        
      
        
          
          
          &middot;
          <a href="/tags/rabbitmq" style="font-size:1.0188679245283019rem">rabbitmq</a>
        
      
        
          
          
          &middot;
          <a href="/tags/raft" style="font-size:1rem">raft</a>
        
      
        
          
          
          &middot;
          <a href="/tags/rebase" style="font-size:1rem">rebase</a>
        
      
        
          
          
          &middot;
          <a href="/tags/redis" style="font-size:1.0377358490566038rem">redis</a>
        
      
        
          
          
          &middot;
          <a href="/tags/resources" style="font-size:1.0188679245283019rem">resources</a>
        
      
        
          
          
          &middot;
          <a href="/tags/rsa" style="font-size:1rem">rsa</a>
        
      
        
          
          
          &middot;
          <a href="/tags/rsync" style="font-size:1.0188679245283019rem">rsync</a>
        
      
        
          
          
          &middot;
          <a href="/tags/safe" style="font-size:1.0754716981132075rem">safe</a>
        
      
        
          
          
          &middot;
          <a href="/tags/samba" style="font-size:1rem">samba</a>
        
      
        
          
          
          &middot;
          <a href="/tags/sealos" style="font-size:1rem">sealos</a>
        
      
        
          
          
          &middot;
          <a href="/tags/secure" style="font-size:1rem">secure</a>
        
      
        
          
          
          &middot;
          <a href="/tags/sed" style="font-size:1rem">sed</a>
        
      
        
          
          
          &middot;
          <a href="/tags/server" style="font-size:1.2075471698113207rem">server</a>
        
      
        
          
          
          &middot;
          <a href="/tags/sftp" style="font-size:1rem">sftp</a>
        
      
        
          
          
          &middot;
          <a href="/tags/shadowsocks" style="font-size:1.0188679245283019rem">shadowsocks</a>
        
      
        
          
          
          &middot;
          <a href="/tags/shell" style="font-size:1.0188679245283019rem">shell</a>
        
      
        
          
          
          &middot;
          <a href="/tags/slap" style="font-size:1rem">slap</a>
        
      
        
          
          
          &middot;
          <a href="/tags/slave" style="font-size:1rem">slave</a>
        
      
        
          
          
          &middot;
          <a href="/tags/slb" style="font-size:1rem">slb</a>
        
      
        
          
          
          &middot;
          <a href="/tags/slowquery" style="font-size:1rem">slowquery</a>
        
      
        
          
          
          &middot;
          <a href="/tags/sonar" style="font-size:1.0377358490566038rem">sonar</a>
        
      
        
          
          
          &middot;
          <a href="/tags/sourcetree" style="font-size:1.0188679245283019rem">sourcetree</a>
        
      
        
          
          
          &middot;
          <a href="/tags/sql" style="font-size:1.0188679245283019rem">sql</a>
        
      
        
          
          
          &middot;
          <a href="/tags/ss" style="font-size:1rem">ss</a>
        
      
        
          
          
          &middot;
          <a href="/tags/ssh" style="font-size:1.0754716981132075rem">ssh</a>
        
      
        
          
          
          &middot;
          <a href="/tags/ssl" style="font-size:1.1132075471698113rem">ssl</a>
        
      
        
          
          
          &middot;
          <a href="/tags/stack" style="font-size:1rem">stack</a>
        
      
        
          
          
          &middot;
          <a href="/tags/stress" style="font-size:1rem">stress</a>
        
      
        
          
          
          &middot;
          <a href="/tags/style" style="font-size:1rem">style</a>
        
      
        
          
          
          &middot;
          <a href="/tags/switchyomega" style="font-size:1rem">switchyomega</a>
        
      
        
          
          
          &middot;
          <a href="/tags/syncd" style="font-size:1rem">syncd</a>
        
      
        
          
          
          &middot;
          <a href="/tags/taint" style="font-size:1rem">taint</a>
        
      
        
          
          
          &middot;
          <a href="/tags/tar" style="font-size:1rem">tar</a>
        
      
        
          
          
          &middot;
          <a href="/tags/tcp" style="font-size:1.0188679245283019rem">tcp</a>
        
      
        
          
          
          &middot;
          <a href="/tags/testing" style="font-size:1rem">testing</a>
        
      
        
          
          
          &middot;
          <a href="/tags/tomcat" style="font-size:1rem">tomcat</a>
        
      
        
          
          
          &middot;
          <a href="/tags/tour" style="font-size:1.0188679245283019rem">tour</a>
        
      
        
          
          
          &middot;
          <a href="/tags/trojan" style="font-size:1rem">trojan</a>
        
      
        
          
          
          &middot;
          <a href="/tags/ubuntu" style="font-size:1.0566037735849056rem">ubuntu</a>
        
      
        
          
          
          &middot;
          <a href="/tags/udp" style="font-size:1rem">udp</a>
        
      
        
          
          
          &middot;
          <a href="/tags/uk8s" style="font-size:1rem">uk8s</a>
        
      
        
          
          
          &middot;
          <a href="/tags/unauthorized" style="font-size:1rem">unauthorized</a>
        
      
        
          
          
          &middot;
          <a href="/tags/unblockneteasemusic" style="font-size:1rem">unblockneteasemusic</a>
        
      
        
          
          
          &middot;
          <a href="/tags/upgrade" style="font-size:1.0188679245283019rem">upgrade</a>
        
      
        
          
          
          &middot;
          <a href="/tags/upstream" style="font-size:1rem">upstream</a>
        
      
        
          
          
          &middot;
          <a href="/tags/v1.18.3" style="font-size:1rem">v1.18.3</a>
        
      
        
          
          
          &middot;
          <a href="/tags/vim" style="font-size:1rem">vim</a>
        
      
        
          
          
          &middot;
          <a href="/tags/virtul" style="font-size:1rem">virtul</a>
        
      
        
          
          
          &middot;
          <a href="/tags/vpn" style="font-size:1.0754716981132075rem">vpn</a>
        
      
        
          
          
          &middot;
          <a href="/tags/vscode" style="font-size:1rem">vscode</a>
        
      
        
          
          
          &middot;
          <a href="/tags/websocket" style="font-size:1rem">websocket</a>
        
      
        
          
          
          &middot;
          <a href="/tags/wifi" style="font-size:1rem">wifi</a>
        
      
        
          
          
          &middot;
          <a href="/tags/xshell" style="font-size:1rem">xshell</a>
        
      
        
          
          
          &middot;
          <a href="/tags/xtrabackup" style="font-size:1rem">xtrabackup</a>
        
      
        
          
          
          &middot;
          <a href="/tags/yum" style="font-size:1rem">yum</a>
        
      
        
          
          
          &middot;
          <a href="/tags/zabbix" style="font-size:1rem">zabbix</a>
        
      
        
          
          
          &middot;
          <a href="/tags/%e6%95%b0%e6%8d%ae%e5%ba%93%e5%8e%9f%e7%90%86" style="font-size:1rem">数据库原理</a>
        
      
        
          
          
          &middot;
          <a href="/tags/%e8%b4%aa%e5%bf%83%e7%ae%97%e6%b3%95" style="font-size:1rem">贪心算法</a>
        
      
      </div>
    
  </div>

  <!-- profile -->
  <!-- toc -->
  
  <div class="bg-white px-4 py-5 box-shadow mb-5 sticky-top">
    <h4 class="mb-4">目录</h4>
    <nav id="TableOfContents">
  <ul>
    <li><a href="#consul-部署使用">consul 部署使用</a>
      <ul>
        <li><a href="#使用">使用</a></li>
      </ul>
    </li>
    <li><a href="#golang-代码">golang 代码</a></li>
  </ul>
</nav>
  </div>

</aside>
<!-- /sidebar -->

    </div>
  </div>
</section>
<!-- /blog details -->



<footer>
	
	<div class="section bg-secondary">
		<div class="container">
			<div class="row justify-content-between">
				
				<div class="col-lg-5 mb-5 mb-lg-0">
					
					<a class="mb-4 d-inline-block" href="/"><img class="img-fluid"
																								src="/images/images/logo-alt.png" alt="Louis Blog" width="60%"></a>
					<p class="text-light mb-5">每一个不曾起舞的日子都是对生命的辜负.</p>
					<h4 class="text-white mb-4">关注我</h4>
					
					<ul class="list-inline social-icon-alt">
						
						<li class="list-inline-item">
							<a class="hover-ripple" href="https://twitter.com/louishong17"><i class="fa fa-twitter"></i></a>
						</li>
						
						<li class="list-inline-item">
							<a class="hover-ripple" href="https://github.com/oldthreefeng"><i class="fa fa-github"></i></a>
						</li>
						
						<li class="list-inline-item">
							<a class="hover-ripple" href="/contact"><i class="fa fa-wechat"></i></a>
						</li>
						
						<li class="list-inline-item">
							<a class="hover-ripple" href="mailto:992165098@qq.com"><i class="fa fa-envelope"></i></a>
						</li>
						
						<li class="list-inline-item">
							<a class="hover-ripple" href="https://www.fenghong.tech/blog/index.xml"><i class="fa fa-rss"></i></a>
						</li>
						
					</ul>
				</div>
				<div class="col-lg-5 mb-5 mb-lg-0">
					
					
					
					
					
					<div class="mb-5">
						<h4 class="text-white mb-4">联系信息</h4>
						<p class="text-light mb-3">上海 · 浦东新区</p>
						<p class="text-light mb-3"></p>
						<p class="text-light mb-3">微信联系方式</p>
						<p class="text-light mb-3"><img src="/images/images/wechat-qrcode.png" width="356px"></p>
					</div>
					
					
				</div>
			</div>
		</div>
	</div>
	
	<div class="bg-secondary-darken py-4">
		<div class="container">
			<div class="row">
				<div class="col-md-6 text-center text-md-left mb-3 mb-md-0">
					<p class="mb-0 text-white">Copyright © 2020 Louis</p>
				</div>
				<div class="col-md-6 text-center text-md-right">
					<ul class="list-inline">
						
						<li class="list-inline-item mx-0"><a class="d-inline-block px-3 text-white" href="https://beian.miit.gov.cn/"
																									class="text-white">鄂ICP备18027870号-1</a></li>
						<p class="list-inline-item mx-0 text-white">本网站由</p>
						<a target="_blank" rel="nofollow noopener" href="https://www.upyun.com/?utm_source=lianmeng&utm_medium=referral"><img src="https://pic.fenghong.tech/images/180803_logo30.png" style="margin-bottom:5px;height: 25px;"></a>
						<p class="list-inline-item mx-0 text-white">提供CDN加速/云存储服务</p>
						
					</ul>
				</div>
			</div>
		</div>
	</div>
</footer>



<script>
	var indexURL = "/index.json"
</script>


<!-- JS Plugins -->

<script src="/plugins/jQuery/jquery.min.js"></script>

<script src="/plugins/bootstrap/bootstrap.min.js"></script>

<script src="/plugins/slick/slick.min.js"></script>

<script src="/plugins/google-map/gmap.js"></script>

<script src="/plugins/venobox/venobox.min.js"></script>

<script src="/plugins/filterizr/jquery.filterizr.min.js"></script>

<script src="/plugins/search/fuse.min.js"></script>

<script src="/plugins/search/mark.js"></script>

<script src="/plugins/search/search.js"></script>

<script src="/plugins/bigPicture/bigPicture.js"></script>

<script src="/plugins/hex_md5/hex_md5.js"></script>


<!-- Main Script -->

<script src="/js/script.min.js"></script>

<!-- Algolia -->
<script src="https://cdn.jsdelivr.net/npm/docsearch.js@2.6.3/dist/cdn/docsearch.min.js"></script>
<script>
	docsearch({
		apiKey: 'b4d47f0c039a84d4035305be829404dd',
		indexName: 'DocSearch',
		appId: 'CTH4P282IZ',
		inputSelector: '#js-algolia-btn',
		debug: false,
	});
</script>

<!-- google analitycs -->

<script>
	(function (i, s, o, g, r, a, m) {
		i['GoogleAnalyticsObject'] = r;
		i[r] = i[r] || function () {
			(i[r].q = i[r].q || []).push(arguments)
		}, i[r].l = 1 * new Date();
		a = s.createElement(o),
			m = s.getElementsByTagName(o)[0];
		a.async = 1;
		a.src = g;
		m.parentNode.insertBefore(a, m)
	})(window, document, 'script', '//www.google-analytics.com/analytics.js', 'ga');
ga('create', 'UA-130595069-1', 'auto');
ga('send', 'pageview');
</script>


<script>
	(function(){
		var bp = document.createElement('script');
		var curProtocol = window.location.protocol.split(':')[0];
		if (curProtocol === 'https'){
			bp.src = 'https://zz.bdstatic.com/linksubmit/push.js';
		}
		else{
			bp.src = 'http://push.zhanzhang.baidu.com/push.js';
		}
		var s = document.getElementsByTagName("script")[0];
		s.parentNode.insertBefore(bp, s);
	})();
</script>
</body>

</html>